<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 1.1: Understanding Your Anxiety Experience</title>
    <style>
        :root {
            --calming-teal: #4a90a4;
            --deep-teal: #357a8a;
            --soft-blue: #6ba3d0;
            --sage-green: #87a96b;
            --warm-gray: #7d8597;
            --gentle-text: #4a5568;
            --light-sage: #f7f8f6;
            --soft-white: #fdfdfd;
            --light-teal: #e8f4f6;
            --accent-orange: #fb923c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.7;
            color: var(--gentle-text);
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Hero Header */
        .hero-header {
            background: linear-gradient(135deg, var(--deep-teal) 0%, var(--calming-teal) 50%, var(--soft-blue) 100%);
            color: white;
            padding: 50px 40px;
            border-radius: 20px;
            margin-bottom: 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255,255,255,0.05) 10px,
                rgba(255,255,255,0.05) 20px
            );
        }

        .hero-header h1 {
            font-size: clamp(2rem, 4vw, 2.8rem);
            font-weight: 700;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }

        .hero-header p {
            font-size: 1.2rem;
            opacity: 0.95;
            position: relative;
            z-index: 1;
        }

        /* Main Content Container */
        .main-content {
            background: var(--soft-white);
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
        }

        /* Provider Voice Section */
        .provider-intro {
            background: var(--light-teal);
            border-left: 5px solid var(--calming-teal);
            padding: 25px 30px;
            border-radius: 0 12px 12px 0;
            margin-bottom: 40px;
        }

        .provider-intro h2 {
            color: var(--deep-teal);
            font-size: 1.6rem;
            margin-bottom: 15px;
        }

        .provider-intro p {
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 12px;
        }

        .provider-note {
            background: rgba(255, 255, 255, 0.7);
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            font-style: italic;
        }

        .provider-note strong {
            color: var(--deep-teal);
            display: block;
            margin-bottom: 8px;
            font-style: normal;
        }

        /* Learning Objectives */
        .objectives-section {
            background: var(--light-sage);
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 40px;
        }

        .objectives-section h3 {
            color: var(--deep-teal);
            font-size: 1.4rem;
            margin-bottom: 20px;
            text-align: center;
        }

        .objectives-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .objective-item {
            background: white;
            padding: 15px 20px;
            border-radius: 8px;
            border-left: 4px solid var(--sage-green);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .objective-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        /* Body Map Section - IMPROVED WITH REALISTIC IMAGE */
        .body-map-section {
            margin: 50px 0;
            text-align: center;
        }

        .body-map-section h2 {
            color: var(--deep-teal);
            font-size: 1.8rem;
            margin-bottom: 15px;
        }

        .body-map-section > p {
            font-size: 1.1rem;
            max-width: 700px;
            margin: 0 auto 30px;
            color: var(--warm-gray);
        }

        .body-map-container {
            background: var(--light-sage);
            padding: 40px;
            border-radius: 16px;
            display: flex;
            gap: 40px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }

        .body-figure {
            position: relative;
            width: 350px;
            height: 500px;
        }

        .body-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 12px;
        }

        /* Interactive Hotspots on Real Body Image */
        .hotspot {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(251, 146, 60, 0.7);
            border: 3px solid var(--accent-orange);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
        }

        .hotspot:hover {
            background: rgba(251, 146, 60, 0.9);
            transform: scale(1.15);
            box-shadow: 0 0 20px rgba(251, 146, 60, 0.5);
        }

        .hotspot.active {
            background: var(--deep-teal);
            border-color: var(--deep-teal);
            box-shadow: 0 0 25px rgba(53, 122, 138, 0.6);
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(251, 146, 60, 0.7);
            }
            50% {
                box-shadow: 0 0 0 10px rgba(251, 146, 60, 0);
            }
        }

        /* Hotspot positions for realistic body */
        .hotspot-head {
            top: 5%;
            left: 50%;
            transform: translateX(-50%);
        }

        .hotspot-chest {
            top: 28%;
            left: 50%;
            transform: translateX(-50%);
        }

        .hotspot-stomach {
            top: 45%;
            left: 50%;
            transform: translateX(-50%);
        }

        .hotspot-hand-left {
            top: 50%;
            left: 8%;
        }

        .hotspot-hand-right {
            top: 50%;
            right: 8%;
        }

        /* Symptom Description Panel */
        .symptom-description {
            flex: 1;
            min-width: 300px;
            max-width: 450px;
            background: white;
            padding: 30px;
            border-radius: 12px;
            border: 2px solid var(--light-teal);
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .symptom-description h3 {
            color: var(--deep-teal);
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .symptom-description p {
            font-size: 1.05rem;
            line-height: 1.8;
            color: var(--gentle-text);
            margin-bottom: 12px;
        }

        .symptom-description.placeholder {
            text-align: center;
            color: var(--warm-gray);
            font-style: italic;
        }

        /* Recognition Section */
        .recognition-section {
            background: var(--light-sage);
            padding: 40px;
            border-radius: 16px;
            margin: 40px 0;
        }

        .recognition-section h2 {
            color: var(--deep-teal);
            font-size: 1.7rem;
            margin-bottom: 25px;
            text-align: center;
        }

        .symptoms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .symptom-category {
            background: white;
            padding: 25px;
            border-radius: 12px;
            border-top: 4px solid var(--calming-teal);
        }

        .symptom-category h4 {
            color: var(--deep-teal);
            font-size: 1.2rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .symptom-category ul {
            list-style: none;
            padding: 0;
        }

        .symptom-category li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
        }

        .symptom-category li::before {
            content: "‚Ä¢";
            position: absolute;
            left: 8px;
            color: var(--sage-green);
            font-size: 1.3rem;
        }

        /* Notebook Integration Section */
        .notebook-section {
            background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%);
            padding: 35px;
            border-radius: 16px;
            border: 2px solid var(--accent-orange);
            margin: 40px 0;
        }

        .notebook-section h3 {
            color: #c2410c;
            font-size: 1.5rem;
            margin-bottom: 20px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .notebook-intro {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 1.05rem;
        }

        .reflection-questions {
            background: white;
            padding: 25px;
            border-radius: 8px;
        }

        .reflection-questions p {
            font-weight: 600;
            color: var(--deep-teal);
            margin-bottom: 10px;
            font-size: 1.05rem;
        }

        .reflection-questions textarea {
            width: 100%;
            min-height: 80px;
            padding: 12px;
            border: 2px solid var(--light-teal);
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            margin-bottom: 20px;
            resize: vertical;
        }

        .reflection-questions textarea:focus {
            outline: none;
            border-color: var(--calming-teal);
            box-shadow: 0 0 0 3px rgba(74, 144, 164, 0.1);
        }

        .save-indicator {
            text-align: center;
            font-size: 0.9rem;
            color: var(--warm-gray);
            margin-top: 10px;
        }

        .save-indicator.saving {
            color: var(--accent-orange);
        }

        .save-indicator.saved {
            color: var(--sage-green);
        }

        /* Key Takeaway */
        .key-takeaway {
            background: var(--light-teal);
            padding: 30px;
            border-radius: 12px;
            border-left: 5px solid var(--deep-teal);
            margin: 40px 0;
        }

        .key-takeaway h3 {
            color: var(--deep-teal);
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .key-takeaway p {
            font-size: 1.15rem;
            line-height: 1.8;
        }

        /* Navigation Buttons */
        .lesson-navigation {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 35px;
            font-size: 1.1rem;
            font-weight: 600;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: var(--sage-green);
            color: white;
        }

        .btn-primary:hover {
            background: #769a59;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(135, 169, 107, 0.3);
        }

        .btn-secondary {
            background: white;
            color: var(--deep-teal);
            border: 2px solid var(--calming-teal);
        }

        .btn-secondary:hover {
            background: var(--light-teal);
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Progress Indicator */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--light-teal);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--sage-green), var(--calming-teal));
            width: 10%;
            transition: width 0.5s ease;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .hero-header {
                padding: 30px 20px;
            }

            .main-content {
                padding: 25px 20px;
            }

            .body-map-container {
                flex-direction: column;
                padding: 25px;
            }

            .body-figure {
                width: 280px;
                height: 400px;
            }

            .symptoms-grid {
                grid-template-columns: 1fr;
            }

            .hotspot {
                width: 50px;
                height: 50px;
                font-size: 24px;
            }
        }

        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        /* Fade-in Animation */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Progress Bar -->
        <div class="progress-bar" role="progressbar" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100">
            <div class="progress-fill"></div>
        </div>

        <!-- Hero Header -->
        <header class="hero-header fade-in">
            <h1>Lesson 1.1: Understanding Your Anxiety Experience</h1>
            <p>Learning to recognize what anxiety feels like in YOUR body</p>
        </header>

        <main class="main-content">
            <!-- Provider Introduction -->
            <section class="provider-intro fade-in">
                <h2>Before We Dive Into the Science...</h2>
                <p>I want to start where you are right now. Not with definitions or diagrams, but with your lived experience. Because anxiety doesn't announce itself with technical terms‚Äîit shows up as a racing heart, a tight chest, or that feeling of dread you can't quite explain.</p>
                
                <p>In my practice, I've worked with hundreds of people struggling with anxiety. One thing I've learned: everyone experiences it differently. Some people feel it in their stomach. Others feel it in their chest or their head. There's no "right" way to experience anxiety.</p>
                
                <div class="provider-note">
                    <strong>A note from David Glenn, PMHNP-BC:</strong>
                    "Understanding YOUR anxiety starts with recognizing how it uniquely shows up in your body and mind. This isn't about learning medical definitions‚Äîit's about becoming an expert on your own experience. That's the foundation everything else builds on."
                </div>
            </section>

            <!-- Learning Objectives -->
            <section class="objectives-section fade-in">
                <h3>What You'll Learn in This Lesson</h3>
                <div class="objectives-list">
                    <div class="objective-item">
                        <span class="objective-icon">üéØ</span>
                        <span>Recognize anxiety signals in YOUR body</span>
                    </div>
                    <div class="objective-item">
                        <span class="objective-icon">üß†</span>
                        <span>Understand the difference between helpful and problematic anxiety</span>
                    </div>
                    <div class="objective-item">
                        <span class="objective-icon">üí≠</span>
                        <span>Identify your personal anxiety patterns</span>
                    </div>
                    <div class="objective-item">
                        <span class="objective-icon">üìù</span>
                        <span>Begin your personal anxiety notebook</span>
                    </div>
                </div>
            </section>

            <!-- Interactive Body Map with Realistic Image -->
            <section class="body-map-section fade-in">
                <h2>Where Do You Feel Anxiety?</h2>
                <p>Click on the glowing areas to learn how anxiety commonly shows up in different parts of your body. Notice which resonate with your own experience.</p>
                
                <div class="body-map-container">
                    <div class="body-figure">
                        <img src="../images/full-body-image.jpg" alt="Full body diagram" class="body-image">
                        
                        <!-- Interactive Hotspots -->
                        <div class="hotspot hotspot-head" 
                             data-symptom="head" 
                             role="button" 
                             tabindex="0" 
                             aria-label="Click to learn about head and mind symptoms">
                            üß†
                        </div>
                        
                        <div class="hotspot hotspot-chest" 
                             data-symptom="chest" 
                             role="button" 
                             tabindex="0" 
                             aria-label="Click to learn about chest and heart symptoms">
                            üíì
                        </div>
                        
                        <div class="hotspot hotspot-stomach" 
                             data-symptom="stomach" 
                             role="button" 
                             tabindex="0" 
                             aria-label="Click to learn about stomach symptoms">
                            ü¶ã
                        </div>
                        
                        <div class="hotspot hotspot-hand-left" 
                             data-symptom="hands" 
                             role="button" 
                             tabindex="0" 
                             aria-label="Click to learn about hand symptoms">
                            ü§≤
                        </div>
                        
                        <div class="hotspot hotspot-hand-right" 
                             data-symptom="hands" 
                             role="button" 
                             tabindex="0" 
                             aria-label="Click to learn about hand symptoms">
                            ü§≤
                        </div>
                    </div>
                    
                    <div class="symptom-description placeholder" id="symptom-display">
                        <p><strong>Click on any glowing area</strong> to explore how anxiety shows up in that part of your body.</p>
                        <p style="margin-top: 15px; font-size: 0.95rem;">Each person's anxiety feels different. This is about discovering YOUR unique experience.</p>
                    </div>
                </div>
            </section>

            <!-- Recognition Grid -->
            <section class="recognition-section fade-in">
                <h2>Common Anxiety Signals: A Comprehensive Look</h2>
                <p style="text-align: center; max-width: 700px; margin: 0 auto 30px; font-size: 1.05rem;">Anxiety affects us physically, mentally, emotionally, and behaviorally. Here's what to watch for:</p>
                
                <div class="symptoms-grid">
                    <div class="symptom-category">
                        <h4><span>üíì</span> Physical Signals</h4>
                        <ul>
                            <li>Racing or pounding heartbeat</li>
                            <li>Shortness of breath or tight chest</li>
                            <li>Stomach upset or nausea</li>
                            <li>Sweating or feeling hot</li>
                            <li>Trembling or shaking</li>
                            <li>Muscle tension or aches</li>
                            <li>Dizziness or lightheadedness</li>
                            <li>Fatigue or exhaustion</li>
                        </ul>
                    </div>
                    
                    <div class="symptom-category">
                        <h4><span>üß†</span> Mental Signals</h4>
                        <ul>
                            <li>Racing thoughts</li>
                            <li>Difficulty concentrating</li>
                            <li>Mind going blank</li>
                            <li>Catastrophic thinking</li>
                            <li>Difficulty making decisions</li>
                            <li>Constant worry about the future</li>
                            <li>Replaying past events</li>
                            <li>Fear of losing control</li>
                        </ul>
                    </div>
                    
                    <div class="symptom-category">
                        <h4><span>üò∞</span> Emotional Signals</h4>
                        <ul>
                            <li>Feeling on edge or restless</li>
                            <li>Sense of impending doom</li>
                            <li>Irritability or anger</li>
                            <li>Feeling overwhelmed</li>
                            <li>Fear or panic</li>
                            <li>Feeling disconnected</li>
                            <li>Sadness or hopelessness</li>
                            <li>Shame or embarrassment</li>
                        </ul>
                    </div>
                    
                    <div class="symptom-category">
                        <h4><span>üèÉ</span> Behavioral Signals</h4>
                        <ul>
                            <li>Avoiding certain situations</li>
                            <li>Procrastinating or overworking</li>
                            <li>Difficulty sleeping</li>
                            <li>Seeking constant reassurance</li>
                            <li>Nervous habits (nail biting, etc.)</li>
                            <li>Social withdrawal</li>
                            <li>Changes in eating patterns</li>
                            <li>Checking or repeating behaviors</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Your Personal Anxiety Notebook -->
            <section class="notebook-section fade-in">
                <h3><span>üìî</span> Your Personal Anxiety Notebook</h3>
                
                <div class="notebook-intro">
                    <p><strong>This is YOUR space to track your unique anxiety experience.</strong> As you work through this course, you'll build a personalized guide to understanding and managing your anxiety. Your responses are saved automatically to your secure notebook.</p>
                </div>
                
                <div class="reflection-questions">
                    <p>1. When I feel anxious, the first thing I notice in my body is:</p>
                    <textarea 
                        id="notebook-physical" 
                        placeholder="Example: My chest gets tight, or my stomach feels queasy..." 
                        aria-label="Describe your first physical anxiety signal"
                        data-notebook-field="lesson-1-1-physical"></textarea>
                    
                    <p>2. The thoughts that typically run through my mind when anxious are:</p>
                    <textarea 
                        id="notebook-thoughts" 
                        placeholder="Example: 'What if something bad happens?' or 'I can't handle this'..." 
                        aria-label="Describe your typical anxious thoughts"
                        data-notebook-field="lesson-1-1-thoughts"></textarea>
                    
                    <p>3. The situations or triggers that most commonly bring on my anxiety include:</p>
                    <textarea 
                        id="notebook-triggers" 
                        placeholder="Example: Social events, work presentations, health concerns..." 
                        aria-label="Describe your common anxiety triggers"
                        data-notebook-field="lesson-1-1-triggers"></textarea>
                    
                    <p>4. When I'm anxious, I tend to (behavioral response):</p>
                    <textarea 
                        id="notebook-behaviors" 
                        placeholder="Example: Avoid the situation, overthink, seek reassurance..." 
                        aria-label="Describe your behavioral response to anxiety"
                        data-notebook-field="lesson-1-1-behaviors"></textarea>
                    
                    <div class="save-indicator" id="save-status">
                        <span>‚ú® Your reflections save automatically as you type</span>
                    </div>
                </div>
            </section>

            <!-- Key Takeaway -->
            <section class="key-takeaway fade-in">
                <h3>üí° The Most Important Thing to Remember</h3>
                <p><strong>Anxiety is information, not a character flaw.</strong> Your body and mind are trying to protect you‚Äîthey're just sometimes overreacting to situations that aren't actually dangerous. Learning to recognize YOUR specific anxiety signals is the first step toward managing them effectively.</p>
                
                <p style="margin-top: 15px;">In the next lesson, we'll explore what's happening in your brain when you feel anxious, and why understanding this changes everything about how you respond.</p>
            </section>

            <!-- Navigation -->
            <nav class="lesson-navigation" aria-label="Lesson navigation">
                <button class="btn btn-secondary" id="download-notes-btn">
                    üíæ Download My Notebook
                </button>
                <a href="lesson-1-2.html" class="btn btn-primary">
                    Continue to Lesson 1.2 ‚Üí
                </a>
            </nav>
        </main>
    </div>

    <script>
        // Configuration - Replace with your actual Directus endpoint
        const DIRECTUS_API = 'YOUR_DIRECTUS_URL/items/student_notebooks';
        const STUDENT_ID = 'CURRENT_STUDENT_ID'; // From authentication

        // Symptom data for interactive body map
        const symptomData = {
            head: {
                title: "Head & Mind Symptoms",
                description: "Racing thoughts, difficulty concentrating, fear of losing control, lightheadedness, headaches, or feeling like your mind is in overdrive. Many people describe it as 'thoughts moving too fast to catch.'",
                clinical: "This is your brain's alarm system working overtime. When anxiety activates, your prefrontal cortex (thinking brain) can get overwhelmed by your amygdala (fear center), making it hard to think clearly."
            },
            chest: {
                title: "Chest & Heart Symptoms",
                description: "Racing or pounding heart, tight chest, shortness of breath, or feeling like you can't get enough air. This is your sympathetic nervous system preparing for 'fight or flight'‚Äîeven when there's no real danger.",
                clinical: "Your heart rate increases to pump more oxygen to your muscles. This is completely normal and not dangerous, even though it can feel scary. It's your body's way of preparing you to respond to a threat."
            },
            stomach: {
                title: "Stomach & Digestive Symptoms",
                description: "Butterflies, nausea, upset stomach, loss of appetite, or sudden digestive issues. That's why we say we have 'butterflies' when nervous‚Äîyour gut is deeply connected to your emotional state.",
                clinical: "Your gut has its own nervous system with more neurons than your spinal cord. When you're anxious, blood flow shifts away from digestion toward your muscles, which can cause these uncomfortable sensations."
            },
            hands: {
                title: "Hands & Extremities",
                description: "Sweaty palms, trembling hands, tingling fingers, or feeling cold in your hands and feet. Blood flow redirects to major muscle groups when your body thinks you need to flee or fight.",
                clinical: "This is called 'peripheral vasoconstriction'‚Äîyour body prioritizes blood flow to core muscles and vital organs during perceived threats, which can make your hands and feet feel cold, tingly, or shaky."
            }
        };

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            setupBodyMap();
            setupNotebookSystem();
            setupAccessibility();
            loadExistingNotes();
        });

        // Body Map Interaction
        function setupBodyMap() {
            const hotspots = document.querySelectorAll('.hotspot');
            const symptomDisplay = document.getElementById('symptom-display');

            hotspots.forEach(hotspot => {
                // Click event
                hotspot.addEventListener('click', function() {
                    const symptomType = this.getAttribute('data-symptom');
                    displaySymptom(symptomType);
                    
                    // Visual feedback
                    hotspots.forEach(h => h.classList.remove('active'));
                    // Activate all hotspots of same type (e.g., both hands)
                    document.querySelectorAll(`[data-symptom="${symptomType}"]`).forEach(h => {
                        h.classList.add('active');
                    });
                });

                // Keyboard accessibility
                hotspot.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        this.click();
                    }
                });
            });
        }

        function displaySymptom(symptomType) {
            const symptomDisplay = document.getElementById('symptom-display');
            const data = symptomData[symptomType];
            
            // Remove placeholder class
            symptomDisplay.classList.remove('placeholder');
            
            // Fade out
            symptomDisplay.style.opacity = '0';
            
            // Update content and fade in
            setTimeout(() => {
                symptomDisplay.innerHTML = `
                    <h3>${data.title}</h3>
                    <p>${data.description}</p>
                    <p style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--light-teal); font-size: 0.95rem; color: var(--warm-gray);">
                        <strong>The science:</strong> ${data.clinical}
                    </p>
                `;
                symptomDisplay.style.opacity = '1';
                
                // Announce to screen readers
                announceToScreenReader(`Displaying ${data.title}: ${data.description}`);
            }, 200);
        }

        // Notebook System with Directus Integration
        function setupNotebookSystem() {
            const textareas = document.querySelectorAll('[data-notebook-field]');
            const saveStatus = document.getElementById('save-status');
            let saveTimeout;

            textareas.forEach(textarea => {
                textarea.addEventListener('input', function() {
                    // Clear previous timeout
                    clearTimeout(saveTimeout);
                    
                    // Show saving indicator
                    saveStatus.className = 'save-indicator saving';
                    saveStatus.innerHTML = '<span>üíæ Saving...</span>';
                    
                    // Debounce save (wait 1 second after typing stops)
                    saveTimeout = setTimeout(() => {
                        saveToNotebook(this);
                    }, 1000);
                });
            });
        }

        async function saveToNotebook(textarea) {
            const field = textarea.getAttribute('data-notebook-field');
            const content = textarea.value;
            const saveStatus = document.getElementById('save-status');
            
            try {
                // Save to localStorage as backup
                localStorage.setItem(field, content);
                
                // TODO: Integrate with your Directus/Supabase backend
                // await fetch(DIRECTUS_API, {
                //     method: 'PATCH',
                //     headers: {
                //         'Content-Type': 'application/json',
                //         'Authorization': `Bearer ${authToken}`
                //     },
                //     body: JSON.stringify({
                //         student_id: STUDENT_ID,
                //         lesson: 'anxiety-toolkit-1-1',
                //         [field]: content,
                //         updated_at: new Date().toISOString()
                //     })
                // });
                
                // Show saved indicator
                saveStatus.className = 'save-indicator saved';
                saveStatus.innerHTML = '<span>‚úÖ Saved to your notebook</span>';
                
                // Reset after 2 seconds
                setTimeout(() => {
                    saveStatus.className = 'save-indicator';
                    saveStatus.innerHTML = '<span>‚ú® Your reflections save automatically as you type</span>';
                }, 2000);
                
            } catch (error) {
                console.error('Save error:', error);
                saveStatus.className = 'save-indicator';
                saveStatus.innerHTML = '<span style="color: var(--accent-orange);">‚ö†Ô∏è Saved locally (server connection issue)</span>';
            }
        }

        function loadExistingNotes() {
            // Load from localStorage (later: load from Directus)
            const textareas = document.querySelectorAll('[data-notebook-field]');
            textareas.forEach(textarea => {
                const field = textarea.getAttribute('data-notebook-field');
                const saved = localStorage.getItem(field);
                if (saved) {
                    textarea.value = saved;
                }
            });
        }

        // Download notebook as PDF
        document.getElementById('download-notes-btn').addEventListener('click', function() {
            const textareas = document.querySelectorAll('[data-notebook-field]');
            let content = `ANXIETY TOOLKIT - LESSON 1.1 REFLECTIONS\n`;
            content += `Date: ${new Date().toLocaleDateString()}\n\n`;
            content += `===========================================\n\n`;
            
            const questions = [
                'When I feel anxious, the first thing I notice in my body is:',
                'The thoughts that typically run through my mind when anxious are:',
                'The situations or triggers that most commonly bring on my anxiety include:',
                "When I'm anxious, I tend to (behavioral response):"
            ];
            
            textareas.forEach((textarea, index) => {
                content += `${index + 1}. ${questions[index]}\n\n`;
                content += `${textarea.value || '(No response yet)'}\n\n`;
                content += `-------------------------------------------\n\n`;
            });
            
            // Create download
            const blob = new Blob([content], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `anxiety-toolkit-lesson-1-1-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        });

        // Accessibility Setup
        function setupAccessibility() {
            // Create live region for screen reader announcements
            const liveRegion = document.createElement('div');
            liveRegion.setAttribute('aria-live', 'polite');
            liveRegion.setAttribute('aria-atomic', 'true');
            liveRegion.className = 'sr-only';
            liveRegion.id = 'live-region';
            document.body.appendChild(liveRegion);

            // Add smooth transition to symptom display
            const symptomDisplay = document.getElementById('symptom-display');
            symptomDisplay.style.transition = 'opacity 0.3s ease';
        }

        function announceToScreenReader(message) {
            const liveRegion = document.getElementById('live-region');
            if (liveRegion) {
                liveRegion.textContent = message;
            }
        }
    </script>
</body>
</html>